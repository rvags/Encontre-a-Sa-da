<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Encontre a Sa√≠da ¬∑ Labirinto da Galinha</title>
    <style>
        /* ========== ESTILOS GLOBAIS (JOGO ORIGINAL) ========== */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            user-select: none;
            font-family: 'Segoe UI', Roboto, system-ui, sans-serif;
        }
        body {
            min-height: 100vh;
            background: linear-gradient(145deg, #0b1a2e, #1a2f3f);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 8px;
        }
        .game-wrapper {
            max-width: 700px;
            width: 100%;
            background: #1e3a5f;
            border-radius: min(48px, 8vw);
            padding: min(24px, 4vw);
            box-shadow: 0 20px 30px rgba(0,0,0,0.7), inset 0 1px 4px #a5c9ff;
            border: 1px solid #5688d0;
        }
        .screen {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: min(20px, 4vw);
            width: 100%;
            height: 100%;
        }
        .active-screen {
            display: flex;
        }
        h1 {
            font-size: clamp(2rem, 10vw, 3rem);
            font-weight: 900;
            text-transform: uppercase;
            color: #f9e56a;
            text-shadow: 0 5px 0 #b45309, 0 10px 15px black;
            letter-spacing: 3px;
            margin-bottom: min(20px, 4vw);
            text-align: center;
        }
        .btn {
            background: #facc15;
            border: none;
            color: #0f172a;
            font-weight: 800;
            font-size: clamp(1.2rem, 6vw, 1.8rem);
            padding: clamp(12px, 3vw, 16px) clamp(24px, 8vw, 48px);
            border-radius: 60px;
            box-shadow: 0 min(10px, 2vw) 0 #b45309, 0 6px 20px black;
            cursor: pointer;
            transition: 0.08s linear;
            margin: min(10px, 2vw);
            border: 2px solid #ffdf7e;
        }
        .btn:active {
            transform: translateY(min(7px, 1.5vw));
            box-shadow: 0 min(3px, 0.8vw) 0 #b45309;
        }
        .menu-buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: min(20px, 4vw);
            width: 100%;
        }
        .menu-btn {
            font-size: clamp(1rem, 5vw, 1.5rem);
            padding: clamp(8px, 2vw, 12px) clamp(16px, 5vw, 28px);
            background: #2b4b75;
            color: white;
            box-shadow: 0 min(7px, 1.5vw) 0 #0f1f2f;
            border: 1px solid #79a7e0;
            flex: 1 1 auto;
            min-width: 120px;
        }
        .top-bar {
            display: flex;
            justify-content: space-between;
            width: 100%;
            background: #112b45;
            padding: clamp(8px, 2vw, 12px) clamp(12px, 3vw, 20px);
            border-radius: 40px;
            color: white;
            font-weight: bold;
            font-size: clamp(0.9rem, 4vw, 1.2rem);
            border: 1px solid #3c6e9c;
            flex-wrap: wrap;
            gap: 8px;
        }
        .currency {
            background: #facc15;
            color: #0f172a;
            padding: 5px 20px;
            border-radius: 30px;
            box-shadow: inset 0 -2px 0 #b45309;
        }
        .chapters-grid, .levels-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: min(12px, 2vw);
            width: 100%;
            margin: min(10px, 2vw) 0;
        }
        .chapter-card {
            background: #27496d;
            border-radius: min(30px, 6vw);
            padding: min(12px, 2vw) min(5px, 1vw);
            text-align: center;
            color: white;
            font-weight: bold;
            box-shadow: 0 min(5px, 1vw) 0 #0f1f2f;
            cursor: pointer;
            border: 1px solid #5e8bc0;
            font-size: clamp(0.8rem, 3.5vw, 1rem);
        }
        .chapter-card.locked {
            opacity: 0.5;
            cursor: not-allowed;
            background: #1f3a52;
        }
        .level-btn {
            background: #0f2b42;
            border-radius: min(20px, 4vw);
            padding: min(10px, 2vw);
            color: white;
            font-weight: bold;
            box-shadow: 0 min(4px, 1vw) 0 #051016;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 1px solid #38658f;
            font-size: clamp(0.7rem, 3vw, 0.9rem);
        }
        .level-btn.locked {
            opacity: 0.5;
            cursor: not-allowed;
            background: #1a2c3b;
        }
        .stars {
            color: #facc15;
            font-size: clamp(1rem, 4vw, 1.2rem);
            letter-spacing: 2px;
        }
        .game-header {
            display: flex;
            width: 100%;
            justify-content: space-between;
            background: #112b45;
            padding: clamp(8px, 2vw, 12px) clamp(12px, 3vw, 20px);
            border-radius: 40px;
            color: white;
            font-size: clamp(0.9rem, 4vw, 1.2rem);
            flex-wrap: wrap;
            gap: 8px;
        }
        .maze-grid {
            display: grid;
            gap: 3px;
            background: #0f1f2f;
            padding: clamp(8px, 2vw, 12px);
            border-radius: min(30px, 6vw);
            margin: min(10px, 2vw) 0;
            width: 100%;
            aspect-ratio: 1 / 1;
        }
        .cell {
            width: 100%;
            aspect-ratio: 1 / 1;
            border-radius: min(8px, 2vw);
            background: #2d4b6e;
            transition: 0.1s;
        }
        .path { background: #cbd5e1; box-shadow: inset 0 -2px 0 #94a3b8; }
        .wall { background: #1e2b3a; box-shadow: inset 0 0 0 1px #4b5563; }
        .player { background: #ef4444 !important; box-shadow: 0 0 0 min(2px, 0.5vw) #fee2e2, 0 min(4px, 1vw) 0 #7f1d1d; transform: translateY(-1px); }
        .target { background: #22c55e !important; box-shadow: 0 0 0 min(2px, 0.5vw) #bbf7d0, 0 min(4px, 1vw) 0 #14532d; transform: translateY(-1px); }
        
        .direction-pad {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: min(8px, 2vw);
            margin: min(10px, 2vw) 0;
        }
        .dir-row {
            display: flex;
            gap: min(20px, 5vw);
            justify-content: center;
        }
        .dir-btn {
            background: #2e4e72;
            border: none;
            color: white;
            font-size: clamp(1.5rem, 8vw, 2.5rem);
            width: clamp(50px, 15vw, 70px);
            height: clamp(50px, 15vw, 70px);
            border-radius: 50%;
            box-shadow: 0 min(6px, 1.5vw) 0 #0f1f2f;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #6590c0;
            transition: 0.08s linear;
        }
        .dir-btn:active {
            transform: translateY(min(4px, 1vw));
            box-shadow: 0 min(2px, 0.5vw) 0 #0f1f2f;
        }
        .items-bar {
            display: flex;
            gap: min(8px, 2vw);
            flex-wrap: wrap;
            justify-content: center;
            margin: min(10px, 2vw) 0;
        }
        .item-btn {
            background: #2e4e72;
            border: none;
            color: white;
            padding: min(8px, 2vw) min(12px, 3vw);
            border-radius: 40px;
            font-weight: bold;
            box-shadow: 0 min(4px, 1vw) 0 #0f1f2f;
            cursor: pointer;
            border: 1px solid #6590c0;
            font-size: clamp(0.8rem, 3.5vw, 1rem);
        }
        .back-btn {
            background: #475569;
            font-size: clamp(0.9rem, 4vw, 1.2rem);
            padding: min(8px, 2vw) min(24px, 6vw);
            box-shadow: 0 min(5px, 1vw) 0 #1e293b;
        }
        .store-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: min(16px, 3vw);
            width: 100%;
        }
        .store-item {
            background: #154360;
            border-radius: min(30px, 6vw);
            padding: min(16px, 3vw);
            color: white;
            text-align: center;
            border: 2px solid #facc15;
            font-size: clamp(0.8rem, 3.5vw, 1rem);
        }
        .price {
            color: #facc15;
            font-weight: bold;
            font-size: clamp(1.2rem, 5vw, 1.4rem);
        }
        .next-level-btn {
            background: #22c55e;
            color: #0f172a;
            font-size: clamp(1rem, 5vw, 1.4rem);
            padding: min(8px, 2vw) min(20px, 5vw);
            box-shadow: 0 min(7px, 1.5vw) 0 #14532d;
        }
        .locked-icon {
            font-size: clamp(1.2rem, 5vw, 1.5rem);
            margin-top: 5px;
        }
        .game-controls {
            display: flex;
            gap: min(10px, 2vw);
            flex-wrap: wrap;
            justify-content: center;
            width: 100%;
        }

        /* ===== NOVA TELA INICIAL COM ANIMA√á√ÉO DA GALINHA ===== */
        #startScreen {
            position: relative;
            overflow: hidden;
            background: transparent; /* o fundo vem dos elementos abaixo */
            min-height: 500px;
        }

        /* Fundo de labirinto */
        .labirinto-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(210, 180, 140, 0.2) 1px, transparent 1px),
                linear-gradient(90deg, rgba(210, 180, 140, 0.2) 1px, transparent 1px);
            background-size: 60px 60px;
            z-index: 0;
        }

        /* Overlay escuro */
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.3);
            z-index: 1;
            pointer-events: none;
        }

        /* Paredes decorativas */
        .parede {
            position: absolute;
            background: #8B5A2B;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            border-radius: 10px;
            z-index: 1;
        }
        .parede1 { top: 10%; left: 8%; width: 180px; height: 25px; transform: rotate(20deg); }
        .parede2 { bottom: 15%; right: 5%; width: 220px; height: 25px; transform: rotate(-10deg); }
        .parede3 { top: 30%; right: 15%; width: 150px; height: 25px; transform: rotate(35deg); }
        .parede4 { bottom: 25%; left: 12%; width: 200px; height: 25px; transform: rotate(-5deg); }

        /* Container principal do t√≠tulo (para ficar acima) */
        .start-content {
            position: relative;
            z-index: 20;
            text-align: center;
            background: rgba(255, 248, 220, 0.85);
            padding: 2rem 4rem;
            border-radius: 60px 60px 30px 30px;
            border: 6px solid #A0522D;
            backdrop-filter: blur(8px);
            box-shadow: 0 20px 30px rgba(0,0,0,0.6), inset 0 0 20px #F5DEB3;
            max-width: 90%;
            margin: 20px auto;
        }
        .start-content h1 {
            font-size: clamp(2rem, 10vw, 3rem);
            color: #5D3A1A;
            text-shadow: 4px 4px 0 #F5DEB3, 6px 6px 0 rgba(0,0,0,0.2);
            margin-bottom: 1rem;
            letter-spacing: 4px;
            font-weight: 900;
            text-transform: uppercase;
        }
        .start-content p {
            font-size: 1.2rem;
            color: #3D2B1A;
            font-weight: bold;
            margin-bottom: 2rem;
            background: rgba(255,255,200,0.3);
            padding: 10px 20px;
            border-radius: 40px;
            display: inline-block;
        }
        .start-content .botao-jogo {
            background: #FF8C00;
            border: none;
            padding: 1rem 3rem;
            font-size: 1.5rem;
            font-weight: bold;
            border-radius: 60px;
            color: #2D1B0E;
            border: 3px solid #F5DEB3;
            box-shadow: 0 8px 0 #B45F06, 0 10px 15px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: 0.1s ease;
            text-transform: uppercase;
        }
        .start-content .botao-jogo:hover {
            transform: translateY(-3px);
            box-shadow: 0 11px 0 #B45F06, 0 15px 20px rgba(0,0,0,0.3);
        }
        .start-content .botao-jogo:active {
            transform: translateY(5px);
            box-shadow: 0 3px 0 #B45F06, 0 8px 12px rgba(0,0,0,0.3);
        }

        /* ===== GALINHA REALISTA EM CSS ===== */
        .pista-corrida {
            position: absolute;
            bottom: 50px;
            left: 0;
            width: 100%;
            height: 200px;
            z-index: 10;
            pointer-events: none;
        }

        .galinha-realista {
            position: absolute;
            width: 200px;
            height: 180px;
            animation: correr 10s linear infinite;
            left: -250px;
            filter: drop-shadow(0 15px 10px rgba(0,0,0,0.3));
        }

        .corpo {
            position: absolute;
            width: 130px;
            height: 100px;
            background: radial-gradient(circle at 30% 40%, #FFD700, #DAA520);
            border-radius: 60% 40% 50% 30% / 60% 50% 40% 40%;
            top: 30px;
            left: 20px;
            box-shadow: inset 5px 5px 10px #B8860B, inset -5px -2px 5px #FFE55C;
            transform: rotate(2deg);
            overflow: hidden;
        }
        .corpo::before {
            content: "";
            position: absolute;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(45deg, transparent, transparent 8px, rgba(255,140,0,0.2) 8px, rgba(255,140,0,0.2) 12px);
            border-radius: inherit;
        }
        .cabeca {
            position: absolute;
            width: 65px;
            height: 60px;
            background: radial-gradient(circle at 60% 40%, #FFD700, #CD853F);
            border-radius: 50% 40% 40% 50%;
            top: 5px;
            left: 60px;
            box-shadow: inset -2px -2px 5px #8B4513, inset 3px 3px 8px #FFE4B5;
            z-index: 5;
        }
        .olho {
            position: absolute;
            width: 14px;
            height: 14px;
            background: white;
            border-radius: 50%;
            top: 18px;
            left: 30px;
            box-shadow: 0 0 0 2px #8B4513;
        }
        .olho::after {
            content: "";
            position: absolute;
            width: 6px;
            height: 6px;
            background: #000;
            border-radius: 50%;
            top: 3px;
            left: 3px;
            box-shadow: 0 0 2px white;
        }
        .olho::before {
            content: "";
            position: absolute;
            width: 3px;
            height: 8px;
            background: white;
            border-radius: 40%;
            top: 2px;
            left: 8px;
            transform: rotate(-15deg);
            opacity: 0.8;
        }
        .crista {
            position: absolute;
            width: 30px;
            height: 25px;
            top: -12px;
            left: 15px;
            display: flex;
            gap: 3px;
        }
        .crista span {
            display: inline-block;
            width: 8px;
            height: 20px;
            background: #FF4500;
            border-radius: 40% 40% 0 0;
            transform: rotate(-5deg);
            box-shadow: 0 2px 3px #8B2500;
        }
        .crista span:nth-child(2) { height: 25px; }
        .crista span:nth-child(3) { height: 18px; }
        .bico {
            position: absolute;
            width: 20px;
            height: 18px;
            background: #FF8C00;
            clip-path: polygon(0% 0%, 100% 50%, 0% 100%);
            top: 25px;
            left: 55px;
            transform: rotate(5deg);
            box-shadow: inset -1px -1px 2px #8B4500;
            z-index: 6;
        }
        .barbela {
            position: absolute;
            width: 12px;
            height: 12px;
            background: #FF6347;
            border-radius: 50%;
            top: 38px;
            left: 45px;
            filter: blur(1px);
            opacity: 0.7;
        }
        .asa {
            position: absolute;
            width: 55px;
            height: 40px;
            background: linear-gradient(145deg, #DAA520, #B8860B);
            border-radius: 60% 20% 50% 30%;
            top: 45px;
            left: 10px;
            transform-origin: top right;
            animation: baterAsa 0.4s infinite alternate ease-in-out;
            box-shadow: inset -3px -2px 5px #8B4513, 2px 5px 8px rgba(0,0,0,0.2);
            z-index: 4;
        }
        .asa::after {
            content: "";
            position: absolute;
            width: 30px;
            height: 20px;
            background: repeating-linear-gradient(45deg, #CD853F, #CD853F 3px, #DAA520 3px, #DAA520 6px);
            border-radius: 40%;
            top: 8px;
            left: 10px;
            opacity: 0.5;
        }
        .perna-esquerda, .perna-direita {
            position: absolute;
            width: 15px;
            height: 45px;
            background: linear-gradient(90deg, #CD853F, #8B4513);
            bottom: 5px;
            border-radius: 20% 20% 40% 40%;
            transform-origin: top center;
            animation: correrPernas 0.3s infinite alternate;
            box-shadow: inset -1px -1px 3px #5D3A1A;
        }
        .perna-esquerda {
            left: 55px;
            animation-delay: -0.15s;
        }
        .perna-direita {
            left: 85px;
        }
        .perna-esquerda::before, .perna-direita::before {
            content: "";
            position: absolute;
            width: 22px;
            height: 18px;
            background: #CD853F;
            border-radius: 40% 40% 20% 20%;
            top: -12px;
            left: -3px;
            box-shadow: inset 0 -2px 3px #8B4513;
        }
        .pe {
            position: absolute;
            bottom: -6px;
            left: -2px;
            width: 20px;
            height: 8px;
            background: #8B4513;
            border-radius: 30% 30% 50% 50%;
            display: flex;
            justify-content: space-around;
        }
        .pe::before, .pe::after {
            content: "";
            width: 5px;
            height: 10px;
            background: #8B4513;
            border-radius: 40%;
            transform: rotate(10deg);
        }
        .pe::before { transform: rotate(-10deg); }
        .pe::after { transform: rotate(10deg); }
        .cauda {
            position: absolute;
            width: 40px;
            height: 35px;
            background: #B8860B;
            border-radius: 20% 50% 20% 50%;
            top: 20px;
            left: -10px;
            transform: rotate(15deg);
            box-shadow: inset -2px -2px 5px #8B4513;
            z-index: 0;
        }
        .cauda::after {
            content: "";
            position: absolute;
            width: 30px;
            height: 25px;
            background: #DAA520;
            border-radius: 20% 50% 20% 50%;
            top: 5px;
            left: 5px;
            opacity: 0.5;
        }
        .sombra {
            position: absolute;
            bottom: 15px;
            left: 30px;
            width: 140px;
            height: 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 50%;
            filter: blur(6px);
            z-index: -1;
        }

        @keyframes correr {
            0% { left: -300px; transform: scaleX(1); }
            20% { left: calc(100% - 200px); transform: scaleX(1); }
            25% { left: calc(100% - 200px); transform: scaleX(-1); }
            45% { transform: scaleX(-1); }
            50% { left: -300px; transform: scaleX(-1); }
            55% { transform: scaleX(1); }
            100% { left: -300px; transform: scaleX(1); }
        }
        @keyframes baterAsa {
            0% { transform: rotate(0deg) scaleY(1); }
            100% { transform: rotate(-30deg) scaleY(0.9); }
        }
        @keyframes correrPernas {
            0% { transform: rotate(20deg) translateY(-2px); height: 48px; }
            100% { transform: rotate(-20deg) translateY(2px); height: 45px; }
        }

        /* ===== TELA DE TUTORIAL ===== */
        #tutorialScreen {
            text-align: center;
            color: white;
        }
        .tutorial-box {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 30px;
            padding: 30px;
            max-width: 500px;
            color: #1e3a5f;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }
        .tutorial-box h2 {
            font-size: 2rem;
            margin-bottom: 20px;
            color: #b45309;
        }
        .tutorial-box p {
            font-size: 1.2rem;
            margin: 15px 0;
            line-height: 1.5;
        }
        .tutorial-box .destaque {
            background: #facc15;
            color: #0f172a;
            padding: 5px 15px;
            border-radius: 40px;
            display: inline-block;
            font-weight: bold;
        }
        .tutorial-box .btn-tutorial {
            background: #22c55e;
            border: none;
            color: #0f172a;
            font-size: 1.5rem;
            font-weight: bold;
            padding: 12px 40px;
            border-radius: 60px;
            cursor: pointer;
            box-shadow: 0 6px 0 #14532d;
            margin-top: 20px;
        }
        .tutorial-box .btn-tutorial:active {
            transform: translateY(4px);
            box-shadow: 0 2px 0 #14532d;
        }
    </style>
</head>
<body>
<div class="game-wrapper" id="gameWrapper">
    <!-- Tela Inicial ANIMADA (agora com a galinha realista) -->
    <div id="startScreen" class="screen active-screen">
        <!-- Fundo do labirinto -->
        <div class="labirinto-bg"></div>
        <div class="overlay"></div>

        <!-- Paredes decorativas -->
        <div class="parede parede1"></div>
        <div class="parede parede2"></div>
        <div class="parede parede3"></div>
        <div class="parede parede4"></div>

        <!-- Conte√∫do principal (t√≠tulo e bot√£o) -->
        <div class="start-content">
            <h1>üêî ENCONTRE A SA√çDA</h1>
            <p>Ajude a galinha a encontrar a sa√≠da do labirinto!</p>
            <button class="botao-jogo" id="startBtn">‚ñ∂ JOGAR</button>
        </div>

        <!-- Galinha realista correndo -->
        <div class="pista-corrida">
            <div class="galinha-realista">
                <div class="corpo"></div>
                <div class="cauda"></div>
                <div class="cabeca">
                    <div class="crista"><span></span><span></span><span></span></div>
                    <div class="olho"></div>
                    <div class="bico"></div>
                    <div class="barbela"></div>
                </div>
                <div class="asa"></div>
                <div class="perna-esquerda"><div class="pe"></div></div>
                <div class="perna-direita"><div class="pe"></div></div>
                <div class="sombra"></div>
            </div>
        </div>
    </div>

    <!-- Tela de Tutorial (aparece ap√≥s clicar em JOGAR) -->
    <div id="tutorialScreen" class="screen">
        <div class="tutorial-box">
            <h2>üê£ Como Jogar</h2>
            <p><span class="destaque">Objetivo:</span> Leve a galinha (üî¥) at√© a sa√≠da verde (üü¢) no menor tempo poss√≠vel.</p>
            <p><span class="destaque">Controles:</span> Use os bot√µes de dire√ß√£o na tela ou as setas do teclado para se mover. O labirinto s√≥ √© revelado ap√≥s o primeiro movimento.</p>
            <p><span class="destaque">Pontua√ß√£o:</span> Ganhe estrelas conforme o tempo: ‚≠ê‚≠ê‚≠ê (r√°pido), ‚≠ê‚≠ê (m√©dio) ou ‚≠ê (lento). Complete n√≠veis para ganhar cristais e desbloquear novos cap√≠tulos.</p>
            <p><span class="destaque">Itens:</span> Compre itens na loja com cristais para te ajudar (ex.: retroceder tempo).</p>
            <button class="btn-tutorial" id="tutorialContinueBtn">Entendi! Vamos l√°</button>
        </div>
    </div>

    <!-- Menu Principal -->
    <div id="mainMenuScreen" class="screen">
        <div class="top-bar">
            <span>üíé <span id="crystalBalance">0</span></span>
            <span>‚≠ê <span id="starBalance">0</span></span>
            <span>üìÖ <span id="dailyDate"></span></span>
        </div>
        <div class="menu-buttons">
            <button class="btn menu-btn" id="dailyBtn">üåû Desafio do Dia</button>
            <button class="btn menu-btn" id="careerBtn">üèÜ Carreira</button>
            <button class="btn menu-btn" id="shopBtn">üõí Loja</button>
        </div>
    </div>

    <!-- Tela Carreira (cap√≠tulos) -->
    <div id="careerScreen" class="screen">
        <div class="top-bar">
            <span>üíé <span id="careerCrystals">0</span></span>
            <span>‚≠ê <span id="careerStars">0</span></span>
            <button class="back-btn" id="backFromCareer">‚Üê Voltar</button>
        </div>
        <h2 style="color:white; margin:0;">Cap√≠tulos</h2>
        <div id="chaptersContainer" class="chapters-grid"></div>
    </div>

    <!-- Tela de N√≠veis de um Cap√≠tulo -->
    <div id="levelsScreen" class="screen">
        <div class="top-bar">
            <span>Cap√≠tulo <span id="currentChapterNum"></span></span>
            <span>‚≠ê <span id="chapterStars">0</span>/<span id="chapterMaxStars">60</span></span>
            <button class="back-btn" id="backFromLevels">‚Üê Voltar</button>
        </div>
        <div id="levelsContainer" class="levels-grid"></div>
    </div>

    <!-- Tela do Jogo -->
    <div id="gameScreen" class="screen">
        <div class="game-header">
            <span>‚è±Ô∏è <span id="gameTimer">0s</span></span>
            <span>üë£ <span id="gameMoves">0</span></span>
            <span>‚≠ê <span id="gameStarsEarn">0</span></span>
        </div>
        <div id="mazeGrid" class="maze-grid"></div>
        
        <div class="direction-pad">
            <div class="dir-row"><button class="dir-btn" id="moveUp">‚Üë</button></div>
            <div class="dir-row">
                <button class="dir-btn" id="moveLeft">‚Üê</button>
                <button class="dir-btn" id="moveDown">‚Üì</button>
                <button class="dir-btn" id="moveRight">‚Üí</button>
            </div>
        </div>

        <div class="items-bar" id="itemsBar"></div>
        <div class="game-controls">
            <button class="back-btn" id="restartGameBtn">‚Ü∫ Recome√ßar</button>
            <button class="back-btn" id="exitGameBtn">üö™ Sair</button>
            <button class="back-btn next-level-btn" id="nextLevelBtn" style="display:none;">‚ñ∂ Pr√≥ximo N√≠vel</button>
        </div>
        <div id="gameMessage" style="color:#facc15; font-weight:bold; text-align:center;"></div>
    </div>

    <!-- Tela do Desafio Di√°rio -->
    <div id="dailyScreen" class="screen">
        <div class="top-bar">
            <span>üìÖ Desafio de Hoje</span>
            <button class="back-btn" id="backFromDaily">‚Üê Voltar</button>
        </div>
        <div id="dailyMazeContainer" style="display:flex; flex-direction:column; align-items:center; gap:15px; width:100%;">
            <div id="dailyMazeGrid" class="maze-grid" style="max-width:300px;"></div>
            <div style="color:white;">‚≠ê Melhor: <span id="dailyBestStars">0</span>  ‚è±Ô∏è <span id="dailyBestTime">-</span></div>
            <button class="btn menu-btn" id="playDailyBtn">Jogar Desafio</button>
        </div>
    </div>

    <!-- Tela da Loja -->
    <div id="shopScreen" class="screen">
        <div class="top-bar">
            <span>üíé <span id="shopCrystals">0</span></span>
            <button class="back-btn" id="backFromShop">‚Üê Voltar</button>
        </div>
        <h2 style="color:white;">Itens</h2>
        <div class="store-grid" id="storeItems"></div>
    </div>
</div>

<script>
    (function() {
        // ---------- CONFIGURA√á√ïES (mesmo do jogo original) ----------
        const CHAPTERS = 5;
        const LEVELS_PER_CHAPTER = 20;
        const TOTAL_LEVELS = 100;
        const SIZES = [5,7,9,11,13];
        const CRYSTALS_PER_COMPLETE = 10;
        const STAR_THRESHOLDS = [0, 30, 40, 50, 60];
        const PATH_PROB = [0.7, 0.65, 0.6, 0.55, 0.5];

        function getTimeLimits(size) {
            if (size <=5) return [8, 15, 25];
            if (size <=7) return [15, 25, 40];
            if (size <=9) return [25, 40, 60];
            if (size <=11) return [35, 55, 80];
            return [45, 70, 100];
        }

        const storeItems = [
            { id: 'rewind', name: '‚è™ Retroceder 5s', price: 15, desc: 'Volta o cron√¥metro 5 segundos' },
            { id: 'freeze', name: '‚ùÑÔ∏è Congelar tempo', price: 25, desc: 'Tempo para por 5s' },
        ];
        let inventory = { rewind: 0, freeze: 0 };

        let crystalBalance = 0;
        let starBalance = 0;

        let careerBestTimes = new Array(TOTAL_LEVELS).fill(null);
        let careerStars = new Array(TOTAL_LEVELS).fill(0);
        let levelUnlocked = new Array(TOTAL_LEVELS).fill(false);
        let chapterUnlocked = [true, false, false, false, false];

        let dailyBest = { time: null, stars: 0, date: '' };

        let currentGame = {
            mode: null,
            levelIndex: 0,
            chapter: 0,
            size: 5,
            grid: [],
            playerPos: { x: 0, y: 0 },
            startPos: { x: 0, y: 0 },
            endPos: { x: 0, y: 0 },
            moves: 0,
            seconds: 0,
            timerInterval: null,
            gameActive: false,
            finished: false,
            firstMove: false,
            revealed: false,
        };

        // Elementos DOM
        const screens = {
            start: document.getElementById('startScreen'),
            tutorial: document.getElementById('tutorialScreen'),
            mainMenu: document.getElementById('mainMenuScreen'),
            career: document.getElementById('careerScreen'),
            levels: document.getElementById('levelsScreen'),
            game: document.getElementById('gameScreen'),
            daily: document.getElementById('dailyScreen'),
            shop: document.getElementById('shopScreen'),
        };
        const crystalSpan = document.getElementById('crystalBalance');
        const starSpan = document.getElementById('starBalance');
        const careerCrystals = document.getElementById('careerCrystals');
        const careerStarsSpan = document.getElementById('careerStars');
        const shopCrystals = document.getElementById('shopCrystals');
        const dailyDateSpan = document.getElementById('dailyDate');
        const chaptersContainer = document.getElementById('chaptersContainer');
        const levelsContainer = document.getElementById('levelsContainer');
        const currentChapterNumSpan = document.getElementById('currentChapterNum');
        const chapterStarsSpan = document.getElementById('chapterStars');
        const chapterMaxStarsSpan = document.getElementById('chapterMaxStars');
        const gameTimer = document.getElementById('gameTimer');
        const gameMoves = document.getElementById('gameMoves');
        const gameStarsEarn = document.getElementById('gameStarsEarn');
        const mazeGridDiv = document.getElementById('mazeGrid');
        const dailyMazeGrid = document.getElementById('dailyMazeGrid');
        const dailyBestStars = document.getElementById('dailyBestStars');
        const dailyBestTime = document.getElementById('dailyBestTime');
        const storeItemsDiv = document.getElementById('storeItems');
        const gameMessage = document.getElementById('gameMessage');
        const itemsBar = document.getElementById('itemsBar');
        const nextLevelBtn = document.getElementById('nextLevelBtn');

        // Bot√µes de movimento
        const moveUpBtn = document.getElementById('moveUp');
        const moveDownBtn = document.getElementById('moveDown');
        const moveLeftBtn = document.getElementById('moveLeft');
        const moveRightBtn = document.getElementById('moveRight');

        // ---------- FUN√á√ïES DE ARMAZENAMENTO (id√™nticas) ----------
        function loadProgress() {
            try {
                const data = JSON.parse(localStorage.getItem('mazeProgressV4'));
                if (data) {
                    crystalBalance = data.crystals || 0;
                    starBalance = data.stars || 0;
                    careerBestTimes = data.careerTimes || new Array(TOTAL_LEVELS).fill(null);
                    careerStars = data.careerStars || new Array(TOTAL_LEVELS).fill(0);
                    levelUnlocked = data.levelUnlocked || new Array(TOTAL_LEVELS).fill(false);
                    chapterUnlocked = data.chapterUnlocked || [true, false, false, false, false];
                    inventory = data.inventory || { rewind:0, freeze:0 };
                    dailyBest = data.dailyBest || { time:null, stars:0, date:'' };
                }
            } catch (e) {}
            levelUnlocked[0] = true;
            const todayStr = getTodayDateString();
            if (dailyBest.date !== todayStr) {
                dailyBest = { time: null, stars: 0, date: todayStr };
                saveProgress();
            }
            updateChaptersUnlock();
        }

        function saveProgress() {
            const data = {
                crystals: crystalBalance,
                stars: starBalance,
                careerTimes: careerBestTimes,
                careerStars: careerStars,
                levelUnlocked: levelUnlocked,
                chapterUnlocked: chapterUnlocked,
                inventory: inventory,
                dailyBest: dailyBest,
            };
            localStorage.setItem('mazeProgressV4', JSON.stringify(data));
            updateStarDisplay();
        }

        function getTodayDateString() {
            const d = new Date();
            return `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;
        }

        function updateChaptersUnlock() {
            for (let c = 0; c < CHAPTERS; c++) {
                if (c === 0) chapterUnlocked[0] = true;
                else {
                    const prevChapterStars = getChapterStars(c-1);
                    chapterUnlocked[c] = prevChapterStars >= STAR_THRESHOLDS[c];
                }
            }
            saveProgress();
        }

        function getChapterStars(chapterIdx) {
            let sum = 0;
            const start = chapterIdx * LEVELS_PER_CHAPTER;
            for (let i=0; i<LEVELS_PER_CHAPTER; i++) sum += careerStars[start + i] || 0;
            return sum;
        }

        // ---------- GERADOR DE LABIRINTO (determin√≠stico) ----------
        function generateMaze(size, chapter, seed = null) {
            const prob = PATH_PROB[chapter-1] || 0.6;
            let rng = seed ? createSeededRandom(seed) : Math.random;
            let grid = Array(size).fill().map(() => Array(size).fill(0));
            grid[0][0] = 1;
            grid[size-1][size-1] = 1;

            for (let y=0; y<size; y++) {
                for (let x=0; x<size; x++) {
                    if ((x===0 && y===0) || (x===size-1 && y===size-1)) continue;
                    grid[y][x] = rng() < prob ? 1 : 0;
                }
            }

            if (!hasPath(grid, {x:0,y:0}, {x:size-1,y:size-1}, size)) {
                let attempts = 0;
                while (!hasPath(grid, {x:0,y:0}, {x:size-1,y:size-1}, size) && attempts < 200) {
                    const x = Math.floor(rng() * size);
                    const y = Math.floor(rng() * size);
                    grid[y][x] = 1;
                    attempts++;
                }
            }
            return grid;
        }

        function createSeededRandom(seed) {
            let state = seed % 2147483647;
            if (state <= 0) state = 1;
            return function() {
                state = (state * 1103515245 + 12345) % 2147483647;
                return state / 2147483647;
            };
        }

        function hasPath(grid, start, end, size) {
            const visited = Array(size).fill().map(() => Array(size).fill(false));
            const queue = [start];
            visited[start.y][start.x] = true;
            while (queue.length) {
                const {x,y} = queue.shift();
                if (x===end.x && y===end.y) return true;
                const dirs = [[0,1],[1,0],[0,-1],[-1,0]];
                for (const [dx,dy] of dirs) {
                    const nx = x+dx, ny = y+dy;
                    if (nx>=0 && nx<size && ny>=0 && ny<size && grid[ny][nx]===1 && !visited[ny][nx]) {
                        visited[ny][nx] = true;
                        queue.push({x:nx, y:ny});
                    }
                }
            }
            return false;
        }

        // ---------- RENDERIZA GRID ----------
        function renderGrid(grid, playerPos, endPos, container, revealed) {
            container.innerHTML = '';
            container.style.gridTemplateColumns = `repeat(${grid.length}, 1fr)`;
            for (let y=0; y<grid.length; y++) {
                for (let x=0; x<grid.length; x++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    if (revealed) {
                        if (grid[y][x] === 1) cell.classList.add('path');
                        else cell.classList.add('wall');
                    } else {
                        cell.classList.add('wall');
                    }
                    if (revealed) {
                        if (x === playerPos.x && y === playerPos.y) cell.classList.add('player');
                        else if (x === endPos.x && y === endPos.y) cell.classList.add('target');
                    } else {
                        if (x === playerPos.x && y === playerPos.y) cell.classList.add('player');
                    }
                    container.appendChild(cell);
                }
            }
        }

        // ---------- L√ìGICA DO JOGO (id√™ntica) ----------
        function startGame(mode, levelIndex, chapter) {
            if (currentGame.timerInterval) clearInterval(currentGame.timerInterval);
            const size = SIZES[chapter-1];
            let seed = null;
            if (mode === 'career') seed = chapter * 1000 + levelIndex;
            else if (mode === 'daily') seed = getSeedFromDate();
            const grid = generateMaze(size, chapter, seed);
            const playerPos = {x:0, y:0};
            const endPos = {x:size-1, y:size-1};
            currentGame = {
                mode, levelIndex, chapter, size,
                grid, playerPos, startPos: {x:0,y:0}, endPos,
                moves: 0, seconds: 0, timerInterval: null,
                gameActive: false, finished: false, firstMove: false,
                revealed: false,
            };
            renderGrid(grid, playerPos, endPos, mazeGridDiv, false);
            gameTimer.textContent = '0s';
            gameMoves.textContent = '0';
            gameStarsEarn.textContent = '0';
            gameMessage.textContent = '';
            nextLevelBtn.style.display = 'none';
            updateItemsBar();
            showScreen('game');
        }

        function handleMove(dx, dy) {
            if (currentGame.finished) return;
            const newX = currentGame.playerPos.x + dx;
            const newY = currentGame.playerPos.y + dy;
            if (newX<0 || newX>=currentGame.size || newY<0 || newY>=currentGame.size) return;
            if (currentGame.grid[newY][newX] === 0) return;

            if (!currentGame.firstMove) {
                currentGame.firstMove = true;
                currentGame.gameActive = true;
                currentGame.revealed = true;
                startGameTimer();
            }

            currentGame.playerPos.x = newX;
            currentGame.playerPos.y = newY;
            currentGame.moves++;
            gameMoves.textContent = currentGame.moves;
            renderGrid(currentGame.grid, currentGame.playerPos, currentGame.endPos, mazeGridDiv, currentGame.revealed);
            checkWin();
        }

        function startGameTimer() {
            if (currentGame.timerInterval) clearInterval(currentGame.timerInterval);
            currentGame.timerInterval = setInterval(() => {
                if (currentGame.gameActive && !currentGame.finished) {
                    currentGame.seconds++;
                    gameTimer.textContent = currentGame.seconds + 's';
                    updateStarsPreview();
                }
            }, 1000);
        }

        function updateStarsPreview() {
            const limits = getTimeLimits(currentGame.size);
            let stars = 0;
            if (currentGame.seconds <= limits[0]) stars = 3;
            else if (currentGame.seconds <= limits[1]) stars = 2;
            else if (currentGame.seconds <= limits[2]) stars = 1;
            gameStarsEarn.textContent = stars;
        }

        function checkWin() {
            if (currentGame.playerPos.x === currentGame.endPos.x && currentGame.playerPos.y === currentGame.endPos.y) {
                currentGame.finished = true;
                currentGame.gameActive = false;
                clearInterval(currentGame.timerInterval);
                const limits = getTimeLimits(currentGame.size);
                let earnedStars = 0;
                if (currentGame.seconds <= limits[0]) earnedStars = 3;
                else if (currentGame.seconds <= limits[1]) earnedStars = 2;
                else if (currentGame.seconds <= limits[2]) earnedStars = 1;
                gameStarsEarn.textContent = earnedStars;
                gameMessage.textContent = `‚ú® Vit√≥ria! +${earnedStars} ‚≠ê  +${CRYSTALS_PER_COMPLETE} üíé`;

                if (currentGame.mode === 'career') {
                    const idx = currentGame.levelIndex;
                    const oldStars = careerStars[idx] || 0;
                    const wasFirstTime = careerBestTimes[idx] === null;
                    if (earnedStars > oldStars) {
                        careerStars[idx] = earnedStars;
                        starBalance += earnedStars - oldStars;
                    }
                    if (wasFirstTime || currentGame.seconds < careerBestTimes[idx]) {
                        careerBestTimes[idx] = currentGame.seconds;
                    }
                    if (wasFirstTime) crystalBalance += CRYSTALS_PER_COMPLETE;

                    if (idx + 1 < TOTAL_LEVELS && !levelUnlocked[idx + 1]) levelUnlocked[idx + 1] = true;
                    updateChaptersUnlock();
                    nextLevelBtn.style.display = (idx + 1 < TOTAL_LEVELS && levelUnlocked[idx + 1]) ? 'inline-block' : 'none';
                } else if (currentGame.mode === 'daily') {
                    const today = getTodayDateString();
                    const wasFirstTimeToday = dailyBest.time === null || dailyBest.date !== today;
                    if (!dailyBest.time || currentGame.seconds < dailyBest.time) {
                        dailyBest.time = currentGame.seconds;
                        dailyBest.stars = earnedStars;
                        dailyBest.date = today;
                    } else if (earnedStars > dailyBest.stars) {
                        dailyBest.stars = earnedStars;
                        dailyBest.date = today;
                    }
                    if (wasFirstTimeToday) crystalBalance += CRYSTALS_PER_COMPLETE;
                }
                saveProgress();
                updateStarDisplay();
            }
        }

        function restartGame() {
            currentGame.playerPos = {x:0, y:0};
            currentGame.moves = 0;
            currentGame.seconds = 0;
            currentGame.gameActive = false;
            currentGame.finished = false;
            currentGame.firstMove = false;
            currentGame.revealed = false;
            clearInterval(currentGame.timerInterval);
            gameTimer.textContent = '0s';
            gameMoves.textContent = '0';
            gameStarsEarn.textContent = '0';
            gameMessage.textContent = '';
            nextLevelBtn.style.display = 'none';
            renderGrid(currentGame.grid, currentGame.playerPos, currentGame.endPos, mazeGridDiv, false);
        }

        function goToNextLevel() {
            if (currentGame.mode === 'career') {
                const nextIdx = currentGame.levelIndex + 1;
                if (nextIdx < TOTAL_LEVELS && levelUnlocked[nextIdx]) {
                    const chapter = Math.floor(nextIdx / LEVELS_PER_CHAPTER) + 1;
                    startGame('career', nextIdx, chapter);
                } else alert('Pr√≥ximo n√≠vel n√£o dispon√≠vel');
            }
        }

        // ---------- ITENS ----------
        function updateItemsBar() {
            itemsBar.innerHTML = '';
            for (const [id, qty] of Object.entries(inventory)) {
                if (qty > 0) {
                    const btn = document.createElement('button');
                    btn.className = 'item-btn';
                    btn.textContent = storeItems.find(i => i.id === id).name + ` (${qty})`;
                    btn.onclick = () => useItem(id);
                    itemsBar.appendChild(btn);
                }
            }
        }

        function useItem(itemId) {
            if (currentGame.finished || !currentGame.gameActive) return;
            if (inventory[itemId] <= 0) return;
            inventory[itemId]--;
            if (itemId === 'rewind') {
                currentGame.seconds = Math.max(0, currentGame.seconds - 5);
                gameTimer.textContent = currentGame.seconds + 's';
            } else if (itemId === 'freeze') {
                currentGame.gameActive = false;
                setTimeout(() => { if (!currentGame.finished) currentGame.gameActive = true; }, 5000);
            }
            saveProgress();
            updateItemsBar();
        }

        // ---------- INTERFACE ----------
        function showScreen(screenId) {
            Object.values(screens).forEach(s => s.classList.remove('active-screen'));
            screens[screenId].classList.add('active-screen');
            if (screenId === 'mainMenu') {
                dailyDateSpan.textContent = new Date().toLocaleDateString();
                updateStarDisplay();
            }
            if (screenId === 'career') renderChapters();
            if (screenId === 'shop') renderShop();
            if (screenId === 'daily') renderDailyScreen();
        }

        function updateStarDisplay() {
            crystalSpan.textContent = crystalBalance;
            starSpan.textContent = starBalance;
            careerCrystals.textContent = crystalBalance;
            careerStarsSpan.textContent = starBalance;
            shopCrystals.textContent = crystalBalance;
        }

        function renderChapters() {
            chaptersContainer.innerHTML = '';
            for (let c=1; c<=CHAPTERS; c++) {
                const div = document.createElement('div');
                div.className = 'chapter-card';
                if (!chapterUnlocked[c-1]) {
                    div.classList.add('locked');
                    div.innerHTML = `Cap. ${c}<br><span class="locked-icon">üîí</span>`;
                } else {
                    div.textContent = `Cap. ${c}`;
                    div.onclick = () => showLevels(c);
                }
                chaptersContainer.appendChild(div);
            }
        }

        function showLevels(chapter) {
            if (!chapterUnlocked[chapter-1]) {
                alert('Cap√≠tulo bloqueado! Complete o cap√≠tulo anterior com estrelas suficientes.');
                return;
            }
            currentChapterNumSpan.textContent = chapter;
            const startIdx = (chapter-1)*LEVELS_PER_CHAPTER;
            const chapterStarsTotal = getChapterStars(chapter-1);
            chapterStarsSpan.textContent = chapterStarsTotal;
            chapterMaxStarsSpan.textContent = LEVELS_PER_CHAPTER * 3;

            levelsContainer.innerHTML = '';
            for (let i=0; i<LEVELS_PER_CHAPTER; i++) {
                const levelIdx = startIdx + i;
                const stars = careerStars[levelIdx] || 0;
                const isUnlocked = levelUnlocked[levelIdx];
                const btn = document.createElement('div');
                btn.className = 'level-btn' + (isUnlocked ? '' : ' locked');
                btn.innerHTML = `<div>N√≠vel ${i+1}</div><div class="stars">${'‚≠ê'.repeat(stars)}${'‚òÜ'.repeat(3-stars)}</div>`;
                if (isUnlocked) btn.onclick = () => startGame('career', levelIdx, chapter);
                else btn.innerHTML += '<div class="locked-icon">üîí</div>';
                levelsContainer.appendChild(btn);
            }
            showScreen('levels');
        }

        function renderDailyScreen() {
            dailyDateSpan.textContent = new Date().toLocaleDateString();
            dailyBestStars.textContent = dailyBest.stars;
            dailyBestTime.textContent = dailyBest.time ? dailyBest.time+'s' : '-';
            const size = 7;
            const seed = getSeedFromDate();
            const grid = generateMaze(size, 2, seed);
            renderGrid(grid, {x:0,y:0}, {x:size-1,y:size-1}, dailyMazeGrid, true);
        }

        function getSeedFromDate() {
            const today = new Date();
            return today.getFullYear()*1000 + (today.getMonth()+1)*50 + today.getDate();
        }

        function renderShop() {
            storeItemsDiv.innerHTML = '';
            storeItems.forEach(item => {
                const div = document.createElement('div');
                div.className = 'store-item';
                div.innerHTML = `
                    <div style="font-size:1.4rem;">${item.name}</div>
                    <div class="price">üíé ${item.price}</div>
                    <div style="font-size:0.9rem; margin:8px 0;">${item.desc}</div>
                    <button class="item-btn" style="font-size:1.2rem;">Comprar</button>
                `;
                div.querySelector('button').onclick = () => buyItem(item);
                storeItemsDiv.appendChild(div);
            });
        }

        function buyItem(item) {
            if (crystalBalance >= item.price) {
                crystalBalance -= item.price;
                inventory[item.id] = (inventory[item.id] || 0) + 1;
                saveProgress();
                renderShop();
                updateStarDisplay();
            } else alert('Cristais insuficientes!');
        }

        // ---------- NOVOS EVENT LISTENERS (tutorial) ----------
        document.getElementById('startBtn').addEventListener('click', () => {
            showScreen('tutorial'); // Vai para a tela de tutorial
        });

        document.getElementById('tutorialContinueBtn').addEventListener('click', () => {
            showScreen('mainMenu'); // Do tutorial vai para o menu principal
        });

        // Demais bot√µes (j√° existentes)
        document.getElementById('dailyBtn').addEventListener('click', () => { renderDailyScreen(); showScreen('daily'); });
        document.getElementById('careerBtn').addEventListener('click', () => showScreen('career'));
        document.getElementById('shopBtn').addEventListener('click', () => { renderShop(); showScreen('shop'); });
        document.getElementById('backFromCareer').addEventListener('click', () => showScreen('mainMenu'));
        document.getElementById('backFromLevels').addEventListener('click', () => showScreen('career'));
        document.getElementById('backFromDaily').addEventListener('click', () => showScreen('mainMenu'));
        document.getElementById('backFromShop').addEventListener('click', () => showScreen('mainMenu'));
        document.getElementById('exitGameBtn').addEventListener('click', () => { clearInterval(currentGame.timerInterval); showScreen('mainMenu'); });
        document.getElementById('restartGameBtn').addEventListener('click', restartGame);
        document.getElementById('playDailyBtn').addEventListener('click', () => startGame('daily', 0, 2));
        document.getElementById('nextLevelBtn').addEventListener('click', goToNextLevel);

        moveUpBtn.addEventListener('click', () => handleMove(0, -1));
        moveDownBtn.addEventListener('click', () => handleMove(0, 1));
        moveLeftBtn.addEventListener('click', () => handleMove(-1, 0));
        moveRightBtn.addEventListener('click', () => handleMove(1, 0));

        window.addEventListener('keydown', (e) => {
            if (!screens.game.classList.contains('active-screen')) return;
            const key = e.key;
            if (key.startsWith('Arrow')) {
                e.preventDefault();
                const dir = { 'ArrowUp': [0,-1], 'ArrowDown': [0,1], 'ArrowLeft': [-1,0], 'ArrowRight': [1,0] }[key];
                if (dir) handleMove(dir[0], dir[1]);
            }
        });

        // Inicializa√ß√£o
        loadProgress();
        updateStarDisplay();
        renderChapters();
        dailyDateSpan.textContent = new Date().toLocaleDateString();
    })();
</script>
</body>
</html>
